---
# Copyright 2017, Steve Wilkerson
# #
# # Licensed under the Apache License, Version 2.0 (the "License");
# # you may not use this file except in compliance with the License.
# # You may obtain a copy of the License at
# #
# #     http://www.apache.org/licenses/LICENSE-2.0
# #
# # Unless required by applicable law or agreed to in writing, software
# # distributed under the License is distributed on an "AS IS" BASIS,
# # WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
# # See the License for the specific language governing permissions and
# # limitations under the License.
# #

- name: bootstrap | check if bootstrap is needed
  raw: which python
  register: need_bootstrap
  ignore_errors: True

- name: bootstrap | install python 2.x
  raw: DEBIAN_FRONTEND=noninteractive apt-get update && apt-get install -y python-minimal aptitude
  when: need_bootstrap | failed

- set_fact:
    ansible_python_interpreter: "/usr/bin/python"

- name: install git
  apt: name=git update_cache=yes state=present state=latest

- name: install vim
  apt: name=vim update_cache=yes state=present state=latest
  
  # Docker install and setup is below.

- name: Install Apt and HTTP Certs
  apt:
    name: "{{ item }}"
    state: present
  with_items:
    - "apt-transport-https"
    - "ca-certificates"

- name: Install APT Key
  apt_key:
    keyserver: hkp://p80.pool.sks-keyservers.net:80
    id: 58118E89F3A912897C070ADBF76221572C52609D

- name: Add Apt Repository
  apt_repository:
    repo: "deb https://apt.dockerproject.org/repo ubuntu-xenial main"
    state: present

- name: Install Docker
  apt:
    name: docker-engine
    state: present
    update_cache: true

- name: Install Docker Compose
  shell: curl -L https://github.com/docker/compose/releases/download/1.8.0/docker-compose-`uname -s`-`uname -m` > /usr/local/bin/docker-compose

- name: Set Permissions on Docker Compose
  file:
    path: /usr/local/bin/docker-compose
    mode: 0755

- name: Start Docker
  service:
    name: docker
    state: started
    enabled: false
  


